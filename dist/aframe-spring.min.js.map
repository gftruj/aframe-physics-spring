{"version":3,"file":"aframe-spring.min.js","sources":["../src/spring.js"],"sourcesContent":["/* globals AFRAME */\nif (typeof AFRAME === 'undefined') {\n  throw new Error('Component attempted to register before AFRAME' +\n    ' was available.');\n}\n\n/* globals CANNON */\nif (typeof CANNON === 'undefined') {\n  throw new Error('Component attempted to register before Cannon.js' +\n    ' was available.');\n}\n\nAFRAME.registerComponent(\"spring\", {\n  schema: {\n    target: {\n      type: 'selector'\n    },\n    restLength: {\n      default: 1\n    },\n    stiffness: {\n      default: 100\n    },\n    damping: {\n      default: 1\n    },\n  },\n  dependencies: ['physics'],\n  multiple: true,\n  init: function() {\n    this.system = this.el.sceneEl.systems.physics\n    this.world = this.system.driver.world\n    this.spring = null\n  },\n  update: function(oldData, newData) {\n    var el = this.el,\n    data = this.data;\n     \n    if (!el.body || !data.target.body) {\n      (el.body ? data.target : el).addEventListener('body-loaded', this.update.bind(this, {}));\n      return;\n    }\n    this.createSpring()\n    this.updateSpring(oldData)\n  },\n  updateSpring: function(oldData) {\n    let data = this.data\n    if (!this.spring) {\n      console.warn(\"Component attempted to change spring before its created. No changes made.\");\n      return;\n    } else if (!data.target) {\n      console.warn(\"Invalid target specified. No changes made.\");\n      return;\n    }\n    Object.keys(data).forEach((attr) => {\n      if (data[attr] !== oldData[attr]) {\n        if (attr === \"target\") {\n          this.spring.bodyB = data.target.body\n          return\n        }\n        this.spring[attr] = data[attr]\n      }\n    })\n  },\n  createSpring: function() {\n    let data = this.data\n    if (!this.dataIsValid(data)) return;\n    this.spring = new CANNON.Spring(this.el.body, data.target.body, {\n      restLength: data.restLength,\n      stiffness: 100,\n      damping: 1,\n    });\n    // Compute the force after each step\n    this.world.addEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n  updateSpringForce: function() {\n    if (this.spring) {\n       this.spring.applyForce()\n    }\n  },\n  dataIsValid: function(data) {\n    if (!data.target) return false\n    return true\n  },\n  play: function() {\n    this.world.addEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n  pause: function() {\n    this.world.removeEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n  remove: function() {\n    this.world.removeEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n    if (this.spring)\n      delete this.spring\n      this.spring = null\n  }\n})\n"],"names":["AFRAME","Error","CANNON","registerComponent","schema","target","type","restLength","default","stiffness","damping","dependencies","multiple","init","this","system","el","sceneEl","systems","physics","world","driver","spring","update","oldData","newData","data","body","createSpring","updateSpring","addEventListener","bind","Object","keys","forEach","attr","bodyB","console","warn","dataIsValid","Spring","updateSpringForce","applyForce","play","pause","removeEventListener","remove"],"mappings":"yBACA,GAAsB,oBAAXA,OACT,MAAM,IAAIC,MAAM,gEAKlB,GAAsB,oBAAXC,OACT,MAAM,IAAID,MAAM,mEAIlBD,OAAOG,kBAAkB,UACvBC,QACEC,QACEC,KAAM,YAERC,YACEC,QAAS,GAEXC,WACED,QAAS,KAEXE,SACEF,QAAS,IAGbG,cAAe,WACfC,UAAU,EACVC,KAAM,WACJC,KAAKC,OAASD,KAAKE,GAAGC,QAAQC,QAAQC,QACtCL,KAAKM,MAAQN,KAAKC,OAAOM,OAAOD,MAChCN,KAAKQ,OAAS,MAEhBC,OAAQ,SAASC,EAASC,GACxB,IAAIT,EAAKF,KAAKE,GACdU,EAAOZ,KAAKY,KAEPV,EAAGW,MAASD,EAAKrB,OAAOsB,MAI7Bb,KAAKc,eACLd,KAAKe,aAAaL,KAJfR,EAAGW,KAAOD,EAAKrB,OAASW,GAAIc,iBAAiB,cAAehB,KAAKS,OAAOQ,KAAKjB,WAMlFe,aAAc,SAASL,GACrB,IAAIE,EAAOZ,KAAKY,KACXZ,KAAKQ,OAGEI,EAAKrB,OAIjB2B,OAAOC,KAAKP,GAAMQ,QAASC,IACzB,GAAIT,EAAKS,KAAUX,EAAQW,GAAO,CAChC,GAAa,WAATA,EAEF,YADArB,KAAKQ,OAAOc,MAAQV,EAAKrB,OAAOsB,MAGlCb,KAAKQ,OAAOa,GAAQT,EAAKS,MAT3BE,QAAQC,KAAK,8CAHbD,QAAQC,KAAK,8EAgBjBV,aAAc,WACZ,IAAIF,EAAOZ,KAAKY,KACXZ,KAAKyB,YAAYb,KACtBZ,KAAKQ,OAAS,IAAIpB,OAAOsC,OAAO1B,KAAKE,GAAGW,KAAMD,EAAKrB,OAAOsB,MACxDpB,WAAYmB,EAAKnB,WACjBE,UAAW,IACXC,QAAS,IAGXI,KAAKM,MAAMU,iBAAiB,WAAYhB,KAAK2B,kBAAkBV,KAAKjB,YAEtE2B,kBAAmB,WACb3B,KAAKQ,QACNR,KAAKQ,OAAOoB,cAGjBH,YAAa,SAASb,GACpB,QAAKA,EAAKrB,QAGZsC,KAAM,WACJ7B,KAAKM,MAAMU,iBAAiB,WAAYhB,KAAK2B,kBAAkBV,KAAKjB,WAEtE8B,MAAO,WACL9B,KAAKM,MAAMyB,oBAAoB,WAAY/B,KAAK2B,kBAAkBV,KAAKjB,WAEzEgC,OAAQ,WACNhC,KAAKM,MAAMyB,oBAAoB,WAAY/B,KAAK2B,kBAAkBV,KAAKjB,UACnEA,KAAKQ,eACAR,KAAKQ,OACZR,KAAKQ,OAAS"}