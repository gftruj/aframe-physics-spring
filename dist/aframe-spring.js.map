{"version":3,"file":"aframe-spring.js","sources":["../src/spring.js"],"sourcesContent":["if (typeof AFRAME === 'undefined') {\n\tthrow new Error('Component attempted to register before a-frame was available');\n}\n\nif (typeof CANNON === 'undefined') {\n\tthrow new Error('Component attempted to register before the a-frame physics system was available');\n}\n\nAFRAME.registerComponent(\"spring\", {\n\n  multiple: true,\n\n  schema: {\n\n    // Target (other) body for the constraint.\n    target: {type: 'selector'},\n\n    // Lenght of the spring, when no force acts upon it\n    restLength: {default: 1, min: 0},\n\n    // how much will the spring suppress the force\n    stiffness: {default: 100, min: 0, max: 0},\n\n    // the stretch factor of the spring\n    damping: {default: 1, min: 0, max: 1},\n  },\n\n  init: function() {\n    this.system = this.el.sceneEl.systems.physics\n    this.world = this.system.driver.world\n    this.spring = /* {CANNON.Constraint} */ null\n  },\n\n  update: function(oldData, newData) {\n    var el = this.el,\n    data = this.data;\n    \n    // wait until the CANNON body is created and attached\n    if (!el.body || !data.target.body) {\n      (el.body ? data.target : el).addEventListener('body-loaded', this.update.bind(this, {}));\n      return;\n    }\n\n    // create the spring if necessary (nonexistent)\n    this.createSpring()\n    // apply new schema to the spring\n    this.updateSpring(oldData)\n  },\n\n  updateSpring: function(oldData) {\n    if (!this.spring) {\n      console.warn(\"Component attempted to change spring before its created. No changes made.\");\n      return;\n    } \n    var data = this.data,\n    spring = this.spring\n    if (!data.target) {\n      console.warn(\"Invalid target specified. No changes made.\");\n      return;\n    }\n    // Cycle through the schema and check if an attribute has changed.\n    // if so, apply it to the spring\n    Object.keys(data).forEach(function(attr) {\n      if (data[attr] !== oldData[attr]) {\n        if (attr === \"target\") {\n          // special case for the target selector\n          spring.bodyB = data.target.body\n          return\n        }\n        spring[attr] = data[attr]\n      }\n    })\n  },\n\n  createSpring: function() {\n    // no need to create a new spring\n    if (this.spring) return\n    var data = this.data\n    if (!this.dataIsValid(data)) return;\n    this.spring = new CANNON.Spring(this.el.body, data.target.body, {\n      restLength: data.restLength,\n      stiffness: data.stiffness,\n      damping: data.damping,\n    });\n    // Compute the force after each step\n    this.world.addEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n\n  // If the spring is valid, update the force each tick the physics are calculated\n  updateSpringForce: function() {\n    if (this.spring) {\n       this.spring.applyForce()\n    }\n  },\n\n  // as for now only check if there is another body to attach\n  dataIsValid: function(data) {\n    if (!data.target) return false\n    return true\n  },\n\n  // resume updating the force when component upon calling play()\n  play: function() {\n    this.world.addEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n\n  // stop updating the force when component upon calling stop()\n  pause: function() {\n    this.world.removeEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n  },\n\n  //remove the event listener + delete the spring\n  remove: function() {\n    this.world.removeEventListener(\"postStep\", this.updateSpringForce.bind(this, {}));\n    if (this.spring)\n      delete this.spring\n      this.spring = null\n  }\n})\n"],"names":[],"mappings":"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"}